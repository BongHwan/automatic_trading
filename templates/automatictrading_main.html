{% extends "base.html" %}
{% block content %}

<h3>계좌 정보</h3>
<div>
  <p>Balance: <span id="balance">{{ arg.account.balance }}</span></p>
  <p>Equity: <span id="equity">{{ arg.account.equity }}</span></p>
</div>
{{ macros.m_hr_black() }}

<h3>주문 관리</h3>
{{ macros.setting_input_text('order_symbol', '심볼') }}
{{ macros.setting_input_int('order_qty', '수량') }}
{{ macros.m_button_group([['add_order_btn', '주문 추가']])}}
<div id="orders_div"></div>
{{ macros.m_hr_black() }}

<h3>포지션 현황</h3>
<div id="positions_div"></div>
{{ macros.m_hr_black() }}

<script type="text/javascript">
hideMenuModule();

var current_data = {};

$(document).ready(function(){
  var socket = io.connect(window.location.href);
  socket.on('status', function(data) {
    current_data = data;
    make_data(data);
  });
});

$("body").on('click', '#add_order_btn', function(e){
  e.preventDefault();
  let symbol = $('#order_symbol').val();
  let qty = $('#order_qty').val();
  if(symbol && qty) {
    globalSendCommand('dummy_update', symbol, qty);
  }
});

function make_data(data) {
  // 계좌 정보 업데이트
  $('#balance').text(data.account.balance);
  $('#equity').text(data.account.equity);

  // 주문 정보 테이블
  let orders_html = "<table class='table table-sm'><thead><tr><th>NO</th><th>심볼</th><th>수량</th></tr></thead><tbody>";
  if(data.orders.length === 0) {
    orders_html += "<tr><td colspan='3'>주문 없음</td></tr>";
  } else {
    for(let i=0;i<data.orders.length;i++){
      orders_html += `<tr><td>${i+1}</td><td>${data.orders[i].symbol}</td><td>${data.orders[i].qty}</td></tr>`;
    }
  }
  orders_html += "</tbody></table>";
  $('#orders_div').html(orders_html);

  // 포지션 정보 테이블
  let pos_html = "<table class='table table-sm'><thead><tr><th>NO</th><th>심볼</th><th>수량</th></tr></thead><tbody>";
  if(data.positions.length === 0) {
    pos_html += "<tr><td colspan='3'>포지션 없음</td></tr>";
  } else {
    for(let i=0;i<data.positions.length;i++){
      pos_html += `<tr><td>${i+1}</td><td>${data.positions[i].symbol}</td><td>${data.positions[i].qty}</td></tr>`;
    }
  }
  pos_html += "</tbody></table>";
  $('#positions_div').html(pos_html);
}
</script>

{% endblock %}
